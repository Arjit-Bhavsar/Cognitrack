<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CogniTrack - Executive Function Assessment</title>
    
    <!-- Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Outfit:wght@400;500;600;700&display=swap" rel="stylesheet">
    
    <style>
/* ============================================================================
   CogniTrack - Professional Blue Theme
   ============================================================================ */

:root {
    /* Professional Blue Palette */
    --bg-primary: #0a1628;
    --bg-secondary: #0f2140;
    --bg-card: #132743;
    --bg-card-hover: #1a3556;
    --bg-elevated: #1e3a5f;
    
    --text-primary: #f8fafc;
    --text-secondary: #94a3b8;
    --text-muted: #64748b;
    
    --blue-50: #eff6ff;
    --blue-100: #dbeafe;
    --blue-200: #bfdbfe;
    --blue-300: #93c5fd;
    --blue-400: #60a5fa;
    --blue-500: #3b82f6;
    --blue-600: #2563eb;
    --blue-700: #1d4ed8;
    --blue-800: #1e40af;
    --blue-900: #1e3a8a;
    
    --accent-primary: #3b82f6;
    --accent-secondary: #60a5fa;
    --accent-light: #93c5fd;
    --accent-success: #22c55e;
    --accent-warning: #f59e0b;
    --accent-danger: #ef4444;
    
    --gradient-primary: linear-gradient(135deg, #3b82f6 0%, #1d4ed8 50%, #1e40af 100%);
    --gradient-light: linear-gradient(135deg, #60a5fa 0%, #3b82f6 100%);
    --gradient-card: linear-gradient(145deg, #132743 0%, #0f2140 100%);
    
    --font-display: 'Outfit', -apple-system, sans-serif;
    --font-body: 'Inter', -apple-system, sans-serif;
    
    --radius-sm: 6px;
    --radius-md: 10px;
    --radius-lg: 16px;
    --radius-xl: 24px;
    --radius-full: 9999px;
    
    --shadow-sm: 0 1px 2px rgba(0, 0, 0, 0.3);
    --shadow-md: 0 4px 12px rgba(0, 0, 0, 0.25);
    --shadow-lg: 0 8px 24px rgba(0, 0, 0, 0.3);
    --shadow-glow: 0 0 30px rgba(59, 130, 246, 0.2);
    --shadow-glow-strong: 0 0 40px rgba(59, 130, 246, 0.35);
    
    --transition-fast: 150ms ease;
    --transition-normal: 250ms ease;
    --transition-slow: 400ms cubic-bezier(0.4, 0, 0.2, 1);
}

*, *::before, *::after {
    box-sizing: border-box;
    margin: 0;
    padding: 0;
}

html {
    font-size: 16px;
    scroll-behavior: smooth;
}

body {
    font-family: var(--font-body);
    background: var(--bg-primary);
    color: var(--text-primary);
    line-height: 1.6;
    min-height: 100vh;
    overflow-x: hidden;
}

/* App Container */
.app-container {
    position: relative;
    min-height: 100vh;
}

/* Ambient Background */
.ambient-bg {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    pointer-events: none;
    z-index: 0;
    overflow: hidden;
}

.orb {
    position: absolute;
    border-radius: 50%;
    filter: blur(100px);
    opacity: 0.5;
    animation: float 25s ease-in-out infinite;
}

.orb-1 {
    width: 700px;
    height: 700px;
    background: radial-gradient(circle, rgba(59, 130, 246, 0.25) 0%, transparent 70%);
    top: -300px;
    left: -200px;
}

.orb-2 {
    width: 500px;
    height: 500px;
    background: radial-gradient(circle, rgba(30, 64, 175, 0.3) 0%, transparent 70%);
    bottom: -200px;
    right: -100px;
    animation-delay: -10s;
}

.orb-3 {
    width: 400px;
    height: 400px;
    background: radial-gradient(circle, rgba(96, 165, 250, 0.15) 0%, transparent 70%);
    top: 40%;
    left: 60%;
    animation-delay: -5s;
}

@keyframes float {
    0%, 100% { transform: translate(0, 0) scale(1); }
    33% { transform: translate(40px, -40px) scale(1.05); }
    66% { transform: translate(-30px, 30px) scale(0.95); }
}

/* Grid Pattern Overlay */
.grid-pattern {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background-image: 
        linear-gradient(rgba(59, 130, 246, 0.03) 1px, transparent 1px),
        linear-gradient(90deg, rgba(59, 130, 246, 0.03) 1px, transparent 1px);
    background-size: 50px 50px;
    pointer-events: none;
    z-index: 0;
}

/* Navigation */
.nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 16px 32px;
    background: rgba(10, 22, 40, 0.85);
    backdrop-filter: blur(20px);
    border-bottom: 1px solid rgba(59, 130, 246, 0.1);
    z-index: 100;
}

.nav-brand {
    display: flex;
    align-items: center;
    gap: 12px;
    text-decoration: none;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.nav-brand:hover {
    opacity: 0.85;
    transform: scale(0.98);
}

.nav-brand:hover .brand-icon {
    box-shadow: var(--shadow-glow-strong);
}

.brand-icon {
    width: 40px;
    height: 40px;
    background: var(--gradient-primary);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    box-shadow: var(--shadow-glow);
}

.brand-icon svg {
    width: 24px;
    height: 24px;
    color: white;
}

.brand-name {
    font-family: var(--font-display);
    font-size: 1.4rem;
    font-weight: 600;
    color: var(--text-primary);
    letter-spacing: -0.5px;
}

.nav-links {
    display: flex;
    gap: 8px;
}

.nav-link {
    color: var(--text-secondary);
    text-decoration: none;
    font-size: 0.9rem;
    font-weight: 500;
    padding: 8px 16px;
    border-radius: var(--radius-md);
    transition: all var(--transition-fast);
}

.nav-link:hover {
    color: var(--accent-secondary);
    background: rgba(59, 130, 246, 0.1);
}

/* Main Content */
.main-content {
    position: relative;
    z-index: 1;
    padding-top: 80px;
    min-height: 100vh;
}

/* Screens */
.screen {
    display: none;
    padding: 48px 24px;
    max-width: 900px;
    margin: 0 auto;
    animation: fadeIn 0.5s ease;
}

.screen.active {
    display: block;
}

@keyframes fadeIn {
    from { opacity: 0; transform: translateY(20px); }
    to { opacity: 1; transform: translateY(0); }
}

/* Welcome Screen */
.welcome-content {
    text-align: center;
    padding: 40px 0;
}

.welcome-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 8px 20px;
    background: rgba(59, 130, 246, 0.1);
    border: 1px solid rgba(59, 130, 246, 0.25);
    border-radius: var(--radius-full);
    color: var(--accent-secondary);
    font-size: 0.85rem;
    font-weight: 500;
    margin-bottom: 24px;
}

.welcome-badge::before {
    content: '';
    width: 8px;
    height: 8px;
    background: var(--accent-primary);
    border-radius: 50%;
    animation: pulse 2s ease-in-out infinite;
}

@keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.2); }
}

.welcome-title {
    font-family: var(--font-display);
    font-size: clamp(2.5rem, 6vw, 4rem);
    font-weight: 700;
    line-height: 1.1;
    margin-bottom: 24px;
    letter-spacing: -1px;
}

.gradient-text {
    background: var(--gradient-light);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-clip: text;
}

.welcome-description {
    font-size: 1.15rem;
    color: var(--text-secondary);
    max-width: 580px;
    margin: 0 auto 48px;
    line-height: 1.7;
}

/* Feature Cards */
.welcome-features {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: 20px;
    margin-bottom: 48px;
}

.feature-card {
    background: var(--gradient-card);
    border: 1px solid rgba(59, 130, 246, 0.1);
    border-radius: var(--radius-lg);
    padding: 28px;
    text-align: left;
    transition: all var(--transition-normal);
    position: relative;
    overflow: hidden;
}

.feature-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 3px;
    background: var(--gradient-primary);
    opacity: 0;
    transition: opacity var(--transition-normal);
}

.feature-card:hover {
    border-color: rgba(59, 130, 246, 0.3);
    transform: translateY(-4px);
    box-shadow: var(--shadow-glow);
}

.feature-card:hover::before {
    opacity: 1;
}

.feature-icon {
    width: 48px;
    height: 48px;
    background: rgba(59, 130, 246, 0.15);
    border-radius: var(--radius-md);
    display: flex;
    align-items: center;
    justify-content: center;
    margin-bottom: 16px;
    color: var(--accent-secondary);
}

.feature-icon svg {
    width: 24px;
    height: 24px;
}

.feature-card h3 {
    font-family: var(--font-display);
    font-size: 1.1rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.feature-card p {
    font-size: 0.9rem;
    color: var(--text-secondary);
    line-height: 1.5;
}

/* Buttons */
.btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 10px;
    padding: 14px 28px;
    font-family: var(--font-body);
    font-size: 1rem;
    font-weight: 600;
    border: none;
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-normal);
    text-decoration: none;
}

.btn svg {
    width: 20px;
    height: 20px;
}

.btn-primary {
    background: var(--gradient-primary);
    color: white;
    box-shadow: 0 4px 20px rgba(59, 130, 246, 0.4);
}

.btn-primary:hover {
    transform: translateY(-2px);
    box-shadow: 0 6px 30px rgba(59, 130, 246, 0.5);
}

.btn-secondary {
    background: var(--bg-card);
    color: var(--text-primary);
    border: 1px solid rgba(59, 130, 246, 0.2);
}

.btn-secondary:hover {
    background: var(--bg-card-hover);
    border-color: var(--accent-primary);
}

.btn-large {
    padding: 18px 36px;
    font-size: 1.1rem;
    border-radius: var(--radius-lg);
}

.welcome-note {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-top: 24px;
    color: var(--text-muted);
    font-size: 0.9rem;
}

.welcome-note svg {
    width: 18px;
    height: 18px;
    color: var(--accent-primary);
}

/* Progress Indicator */
.progress-indicator {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    margin-bottom: 32px;
}

.progress-step {
    width: 36px;
    height: 36px;
    display: flex;
    align-items: center;
    justify-content: center;
    border-radius: 50%;
    background: var(--bg-card);
    border: 2px solid rgba(59, 130, 246, 0.2);
    font-size: 0.9rem;
    font-weight: 600;
    color: var(--text-muted);
    transition: all var(--transition-normal);
}

.progress-step.active {
    background: var(--gradient-primary);
    border-color: var(--accent-primary);
    color: white;
    box-shadow: var(--shadow-glow);
}

.progress-step.completed {
    background: var(--accent-success);
    border-color: var(--accent-success);
    color: white;
}

.progress-line {
    width: 50px;
    height: 3px;
    background: rgba(59, 130, 246, 0.15);
    border-radius: var(--radius-full);
    transition: background var(--transition-normal);
}

.progress-line.filled {
    background: var(--accent-success);
}

/* Screen Header */
.screen-header {
    text-align: center;
    margin-bottom: 32px;
}

.screen-title {
    font-family: var(--font-display);
    font-size: 1.75rem;
    font-weight: 600;
    margin-bottom: 8px;
}

.screen-subtitle {
    color: var(--text-secondary);
    font-size: 1rem;
}

/* Self Report Form */
.self-report-form {
    background: var(--gradient-card);
    border: 1px solid rgba(59, 130, 246, 0.1);
    border-radius: var(--radius-xl);
    padding: 32px;
    margin-bottom: 24px;
}

.slider-group {
    margin-bottom: 28px;
}

.slider-label {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 12px;
}

.label-text {
    font-weight: 500;
    font-size: 0.95rem;
}

.label-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent-secondary);
    min-width: 40px;
    text-align: right;
}

.slider-container {
    display: flex;
    align-items: center;
    gap: 16px;
}

.slider-min, .slider-max {
    font-size: 0.8rem;
    color: var(--text-muted);
    min-width: 80px;
}

.slider-max {
    text-align: right;
}

.slider {
    flex: 1;
    height: 8px;
    -webkit-appearance: none;
    appearance: none;
    background: rgba(59, 130, 246, 0.15);
    border-radius: var(--radius-full);
    outline: none;
}

.slider::-webkit-slider-thumb {
    -webkit-appearance: none;
    width: 24px;
    height: 24px;
    background: var(--gradient-primary);
    border-radius: 50%;
    cursor: pointer;
    box-shadow: 0 2px 10px rgba(59, 130, 246, 0.5);
    transition: transform var(--transition-fast);
}

.slider::-webkit-slider-thumb:hover {
    transform: scale(1.15);
}

.slider::-moz-range-thumb {
    width: 24px;
    height: 24px;
    background: var(--gradient-primary);
    border-radius: 50%;
    cursor: pointer;
    border: none;
}

/* Checkboxes */
.checkbox-group {
    display: flex;
    gap: 32px;
    margin-bottom: 28px;
    flex-wrap: wrap;
}

.checkbox-label {
    display: flex;
    align-items: center;
    gap: 12px;
    cursor: pointer;
    font-size: 0.95rem;
}

.checkbox-label input {
    display: none;
}

.checkmark {
    width: 24px;
    height: 24px;
    border: 2px solid rgba(59, 130, 246, 0.3);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    transition: all var(--transition-fast);
    background: var(--bg-secondary);
}

.checkbox-label input:checked + .checkmark {
    background: var(--gradient-primary);
    border-color: var(--accent-primary);
}

.checkbox-label input:checked + .checkmark::after {
    content: '‚úì';
    color: white;
    font-size: 14px;
    font-weight: 700;
}

/* Mood Selector */
.mood-selector {
    margin-top: 24px;
}

.mood-label {
    display: block;
    font-weight: 500;
    margin-bottom: 16px;
}

.mood-options {
    display: flex;
    flex-wrap: wrap;
    gap: 10px;
}

.mood-btn {
    padding: 10px 18px;
    background: var(--bg-secondary);
    border: 1px solid rgba(59, 130, 246, 0.15);
    border-radius: var(--radius-full);
    color: var(--text-secondary);
    font-family: var(--font-body);
    font-size: 0.9rem;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.mood-btn:hover {
    border-color: var(--accent-primary);
    color: var(--text-primary);
    background: rgba(59, 130, 246, 0.1);
}

.mood-btn.selected {
    background: var(--gradient-primary);
    border-color: transparent;
    color: white;
    box-shadow: var(--shadow-glow);
}

/* Task Instructions */
.task-instructions {
    text-align: center;
    padding: 48px 24px;
    background: var(--gradient-card);
    border: 1px solid rgba(59, 130, 246, 0.1);
    border-radius: var(--radius-xl);
}

.task-icon {
    width: 100px;
    height: 100px;
    margin: 0 auto 32px;
    background: rgba(59, 130, 246, 0.1);
    border-radius: var(--radius-lg);
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--accent-secondary);
}

.task-icon svg {
    width: 56px;
    height: 56px;
}

.task-instructions h2 {
    font-family: var(--font-display);
    font-size: 1.75rem;
    font-weight: 600;
    margin-bottom: 16px;
}

.task-description {
    color: var(--text-secondary);
    max-width: 500px;
    margin: 0 auto 32px;
    line-height: 1.7;
    font-size: 1.05rem;
}

.task-tips {
    display: flex;
    justify-content: center;
    gap: 40px;
    margin-bottom: 32px;
    flex-wrap: wrap;
}

.tip {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 8px;
}

.tip-icon {
    font-size: 2rem;
}

.tip span:last-child {
    font-size: 0.9rem;
    color: var(--text-secondary);
    font-weight: 500;
}

kbd {
    display: inline-block;
    padding: 4px 10px;
    background: var(--bg-elevated);
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: var(--radius-sm);
    font-family: 'SF Mono', Consolas, monospace;
    font-size: 0.9em;
    color: var(--accent-secondary);
}

.go-text {
    color: var(--accent-success);
    font-weight: 600;
}

.nogo-text {
    color: var(--accent-danger);
    font-weight: 600;
}

/* Go/No-Go Icon */
.go-nogo-icon {
    display: flex;
    gap: 16px;
    justify-content: center;
}

.go-symbol, .nogo-symbol {
    width: 44px;
    height: 44px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 0.8rem;
    font-weight: 700;
    color: white;
}

.go-symbol {
    background: var(--accent-success);
}

.nogo-symbol {
    background: var(--accent-danger);
    font-size: 1.4rem;
}

/* Task Area */
.task-area {
    padding: 32px;
    background: var(--gradient-card);
    border: 1px solid rgba(59, 130, 246, 0.1);
    border-radius: var(--radius-xl);
}

.task-area.hidden {
    display: none;
}

.task-status {
    display: flex;
    justify-content: center;
    gap: 48px;
    margin-bottom: 32px;
    flex-wrap: wrap;
}

.status-item {
    text-align: center;
}

.status-label {
    display: block;
    font-size: 0.8rem;
    color: var(--text-muted);
    margin-bottom: 4px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.status-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent-secondary);
}

/* Working Memory Grid */
.wm-message {
    text-align: center;
    font-size: 1.15rem;
    color: var(--text-secondary);
    margin-bottom: 32px;
    min-height: 30px;
    font-weight: 500;
}

.wm-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    max-width: 320px;
    margin: 0 auto;
}

.wm-cell {
    aspect-ratio: 1;
    background: var(--bg-secondary);
    border: 2px solid rgba(59, 130, 246, 0.2);
    border-radius: var(--radius-md);
    cursor: pointer;
    transition: all var(--transition-fast);
}

.wm-cell:hover:not(.showing) {
    border-color: var(--accent-primary);
    background: rgba(59, 130, 246, 0.1);
}

.wm-cell.active {
    background: var(--gradient-primary);
    border-color: var(--accent-primary);
    box-shadow: var(--shadow-glow-strong);
}

.wm-cell.correct {
    background: var(--accent-success);
    border-color: var(--accent-success);
    box-shadow: 0 0 20px rgba(34, 197, 94, 0.5);
}

.wm-cell.incorrect {
    background: var(--accent-danger);
    border-color: var(--accent-danger);
    box-shadow: 0 0 20px rgba(239, 68, 68, 0.5);
}

.wm-cell.showing {
    pointer-events: none;
}

/* Inhibition Display */
.inhibition-display {
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    min-height: 280px;
    position: relative;
}

.stimulus-circle {
    width: 140px;
    height: 140px;
    border-radius: 50%;
    background: var(--bg-secondary);
    border: 4px solid rgba(59, 130, 246, 0.2);
    transition: all 0.1s ease;
}

.stimulus-circle.go {
    background: var(--accent-success);
    border-color: var(--accent-success);
    box-shadow: 0 0 60px rgba(34, 197, 94, 0.6);
}

.stimulus-circle.nogo {
    background: var(--accent-danger);
    border-color: var(--accent-danger);
    box-shadow: 0 0 60px rgba(239, 68, 68, 0.6);
}

.inhibition-feedback {
    position: absolute;
    bottom: 20px;
    font-size: 1.2rem;
    font-weight: 600;
    opacity: 0;
    transition: opacity var(--transition-fast);
}

.inhibition-feedback.show {
    opacity: 1;
}

.inhibition-feedback.correct {
    color: var(--accent-success);
}

.inhibition-feedback.incorrect {
    color: var(--accent-danger);
}

.inhibition-prompt {
    text-align: center;
    color: var(--text-muted);
    font-size: 0.95rem;
    margin-top: 32px;
}

/* Results Screen */
.results-container {
    max-width: 800px;
    margin: 0 auto;
}

.results-title {
    font-family: var(--font-display);
    font-size: 2rem;
    font-weight: 700;
}

.results-summary {
    background: var(--gradient-card);
    border: 1px solid rgba(59, 130, 246, 0.15);
    border-radius: var(--radius-xl);
    padding: 40px;
    text-align: center;
    margin-bottom: 24px;
}

.strain-indicator {
    margin-bottom: 24px;
}

.strain-ring {
    position: relative;
    width: 160px;
    height: 160px;
    margin: 0 auto;
}

.strain-ring svg {
    transform: rotate(-90deg);
    width: 100%;
    height: 100%;
}

.strain-bg {
    fill: none;
    stroke: rgba(59, 130, 246, 0.1);
    stroke-width: 10;
}

.strain-fill {
    fill: none;
    stroke: url(#strainGradient);
    stroke-width: 10;
    stroke-linecap: round;
    stroke-dasharray: 377;
    stroke-dashoffset: 377;
    transition: stroke-dashoffset 1.2s cubic-bezier(0.4, 0, 0.2, 1);
}

.strain-content {
    position: absolute;
    top: 50%;
    left: 50%;
    transform: translate(-50%, -50%);
    text-align: center;
}

.strain-value {
    display: block;
    font-size: 2.5rem;
    font-weight: 700;
    color: var(--accent-secondary);
}

.strain-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    text-transform: uppercase;
    letter-spacing: 0.5px;
}

.strain-level {
    font-family: var(--font-display);
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 12px;
    text-transform: capitalize;
}

.strain-level.low { color: var(--accent-success); }
.strain-level.moderate { color: var(--accent-secondary); }
.strain-level.elevated { color: var(--accent-warning); }
.strain-level.high { color: var(--accent-danger); }

.strain-interpretation {
    color: var(--text-secondary);
    max-width: 500px;
    margin: 0 auto;
    line-height: 1.6;
}

/* Score Cards */
.score-cards {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    gap: 20px;
    margin-bottom: 24px;
}

.score-card {
    background: var(--gradient-card);
    border: 1px solid rgba(59, 130, 246, 0.1);
    border-radius: var(--radius-lg);
    padding: 24px;
}

.score-header {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 16px;
}

.score-icon {
    font-size: 1.4rem;
}

.score-title {
    font-weight: 600;
    font-size: 0.95rem;
}

.score-value {
    font-size: 3rem;
    font-weight: 700;
    margin-bottom: 16px;
    color: var(--accent-secondary);
}

.score-bar {
    height: 8px;
    background: rgba(59, 130, 246, 0.1);
    border-radius: var(--radius-full);
    overflow: hidden;
    margin-bottom: 16px;
}

.score-fill {
    height: 100%;
    background: var(--gradient-primary);
    border-radius: var(--radius-full);
    width: 0;
    transition: width 1s cubic-bezier(0.4, 0, 0.2, 1);
}

.fatigue-bar .score-fill {
    background: linear-gradient(90deg, var(--accent-warning), var(--accent-danger));
}

.score-interpretation {
    font-size: 0.85rem;
    color: var(--text-secondary);
    line-height: 1.5;
}

/* Recommendations */
.recommendations-section {
    background: var(--gradient-card);
    border: 1px solid rgba(59, 130, 246, 0.1);
    border-radius: var(--radius-xl);
    padding: 32px;
    margin-bottom: 24px;
}

.recommendations-title {
    display: flex;
    align-items: center;
    gap: 12px;
    font-family: var(--font-display);
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 24px;
}

.recommendations-title svg {
    width: 24px;
    height: 24px;
    color: var(--accent-primary);
}

.recommendations-list {
    display: flex;
    flex-direction: column;
    gap: 16px;
}

.recommendation-card {
    display: flex;
    gap: 20px;
    padding: 20px;
    background: var(--bg-secondary);
    border-radius: var(--radius-lg);
    border-left: 4px solid var(--accent-primary);
    transition: all var(--transition-fast);
}

.recommendation-card:hover {
    background: var(--bg-card-hover);
}

.recommendation-card.priority-high {
    border-left-color: var(--accent-danger);
}

.recommendation-card.priority-medium {
    border-left-color: var(--accent-warning);
}

.rec-icon {
    width: 52px;
    height: 52px;
    display: flex;
    align-items: center;
    justify-content: center;
    background: rgba(59, 130, 246, 0.1);
    border-radius: var(--radius-md);
    font-size: 1.6rem;
    flex-shrink: 0;
}

.rec-content {
    flex: 1;
}

.rec-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 8px;
    gap: 12px;
    flex-wrap: wrap;
}

.rec-title {
    font-weight: 600;
    font-size: 1.05rem;
}

.rec-priority {
    font-size: 0.7rem;
    padding: 4px 10px;
    border-radius: var(--radius-full);
    text-transform: uppercase;
    font-weight: 700;
    letter-spacing: 0.5px;
}

.rec-priority.high {
    background: rgba(239, 68, 68, 0.15);
    color: var(--accent-danger);
}

.rec-priority.medium {
    background: rgba(245, 158, 11, 0.15);
    color: var(--accent-warning);
}

.rec-priority.low {
    background: rgba(59, 130, 246, 0.15);
    color: var(--accent-secondary);
}

.rec-description {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 12px;
    line-height: 1.5;
}

.rec-meta {
    display: flex;
    gap: 20px;
    font-size: 0.8rem;
    color: var(--text-muted);
}

.rec-duration::before {
    content: '‚è±Ô∏è ';
}

/* Detailed Metrics */
.detailed-metrics {
    background: var(--gradient-card);
    border: 1px solid rgba(59, 130, 246, 0.1);
    border-radius: var(--radius-lg);
    padding: 20px;
    margin-bottom: 24px;
}

.detailed-metrics summary {
    cursor: pointer;
    font-weight: 600;
    color: var(--text-secondary);
    padding: 8px;
    border-radius: var(--radius-sm);
    transition: all var(--transition-fast);
}

.detailed-metrics summary:hover {
    color: var(--text-primary);
    background: rgba(59, 130, 246, 0.05);
}

.metrics-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(140px, 1fr));
    gap: 16px;
    padding-top: 20px;
}

.metric-item {
    text-align: center;
    padding: 16px;
    background: var(--bg-secondary);
    border-radius: var(--radius-md);
}

.metric-value {
    font-size: 1.5rem;
    font-weight: 700;
    color: var(--accent-secondary);
}

.metric-label {
    font-size: 0.75rem;
    color: var(--text-muted);
    margin-top: 4px;
    text-transform: uppercase;
    letter-spacing: 0.3px;
}

/* Results Actions */
.results-actions {
    display: flex;
    justify-content: center;
    gap: 16px;
    flex-wrap: wrap;
}

/* Python Code Section */
.python-section {
    background: var(--gradient-card);
    border: 1px solid rgba(59, 130, 246, 0.1);
    border-radius: var(--radius-xl);
    padding: 32px;
    margin-top: 24px;
}

.python-section h3 {
    font-family: var(--font-display);
    font-size: 1.25rem;
    font-weight: 600;
    margin-bottom: 8px;
    display: flex;
    align-items: center;
    gap: 10px;
}

.python-section h3::before {
    content: 'üêç';
}

.python-section > p {
    color: var(--text-secondary);
    font-size: 0.9rem;
    margin-bottom: 20px;
}

.code-container {
    background: #0d1117;
    border-radius: var(--radius-md);
    overflow: hidden;
}

.code-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: 12px 16px;
    background: #161b22;
    border-bottom: 1px solid #30363d;
}

.code-filename {
    font-family: 'SF Mono', Consolas, monospace;
    font-size: 0.85rem;
    color: var(--text-secondary);
}

.copy-btn {
    padding: 6px 12px;
    background: rgba(59, 130, 246, 0.15);
    border: 1px solid rgba(59, 130, 246, 0.3);
    border-radius: var(--radius-sm);
    color: var(--accent-secondary);
    font-size: 0.8rem;
    font-weight: 500;
    cursor: pointer;
    transition: all var(--transition-fast);
}

.copy-btn:hover {
    background: rgba(59, 130, 246, 0.25);
}

.code-block {
    max-height: 500px;
    overflow: auto;
    padding: 16px;
}

.code-block pre {
    margin: 0;
    font-family: 'SF Mono', Consolas, 'Courier New', monospace;
    font-size: 0.8rem;
    line-height: 1.6;
    color: #c9d1d9;
    white-space: pre;
    tab-size: 4;
}

.code-block::-webkit-scrollbar {
    width: 8px;
    height: 8px;
}

.code-block::-webkit-scrollbar-track {
    background: #161b22;
}

.code-block::-webkit-scrollbar-thumb {
    background: #30363d;
    border-radius: 4px;
}

.code-block::-webkit-scrollbar-thumb:hover {
    background: #484f58;
}

/* Syntax Highlighting */
.keyword { color: #ff7b72; }
.string { color: #a5d6ff; }
.comment { color: #8b949e; }
.function { color: #d2a8ff; }
.class { color: #7ee787; }
.number { color: #79c0ff; }
.decorator { color: #ffa657; }

/* Modals */
.modal {
    display: none;
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    bottom: 0;
    background: rgba(10, 22, 40, 0.9);
    backdrop-filter: blur(10px);
    z-index: 200;
    align-items: center;
    justify-content: center;
    padding: 24px;
}

.modal.active {
    display: flex;
}

.modal-content {
    background: var(--bg-card);
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: var(--radius-xl);
    padding: 40px;
    max-width: 600px;
    max-height: 80vh;
    overflow-y: auto;
    position: relative;
}

.modal-close {
    position: absolute;
    top: 16px;
    right: 16px;
    width: 36px;
    height: 36px;
    background: var(--bg-secondary);
    border: 1px solid rgba(59, 130, 246, 0.2);
    border-radius: 50%;
    color: var(--text-secondary);
    font-size: 1.25rem;
    cursor: pointer;
    transition: all var(--transition-fast);
    display: flex;
    align-items: center;
    justify-content: center;
}

.modal-close:hover {
    background: var(--accent-primary);
    border-color: var(--accent-primary);
    color: white;
}

.modal-content h2 {
    font-family: var(--font-display);
    font-size: 1.5rem;
    font-weight: 600;
    margin-bottom: 20px;
}

.modal-content h3 {
    font-size: 1.1rem;
    font-weight: 600;
    margin-top: 24px;
    margin-bottom: 12px;
    color: var(--accent-secondary);
}

.modal-content p {
    color: var(--text-secondary);
    margin-bottom: 16px;
    line-height: 1.6;
}

.modal-content ul {
    color: var(--text-secondary);
    padding-left: 24px;
    margin-bottom: 16px;
}

.modal-content li {
    margin-bottom: 8px;
    line-height: 1.5;
}

/* Responsive */
@media (max-width: 768px) {
    .nav {
        padding: 12px 16px;
    }
    
    .nav-links {
        gap: 4px;
    }
    
    .nav-link {
        padding: 8px 12px;
        font-size: 0.85rem;
    }
    
    .screen {
        padding: 32px 16px;
    }
    
    .welcome-features {
        grid-template-columns: 1fr;
    }
    
    .task-tips {
        gap: 24px;
    }
    
    .checkbox-group {
        flex-direction: column;
        gap: 16px;
    }
    
    .score-cards {
        grid-template-columns: 1fr;
    }
    
    .recommendation-card {
        flex-direction: column;
        gap: 16px;
    }
    
    .results-actions {
        flex-direction: column;
    }
    
    .results-actions .btn {
        width: 100%;
    }
    
    .wm-grid {
        max-width: 280px;
        gap: 12px;
    }
}
    </style>
</head>
<body>
    <!-- SVG Definitions -->
    <svg style="position: absolute; width: 0; height: 0;">
        <defs>
            <linearGradient id="strainGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                <stop offset="0%" style="stop-color:#60a5fa"/>
                <stop offset="50%" style="stop-color:#3b82f6"/>
                <stop offset="100%" style="stop-color:#1d4ed8"/>
            </linearGradient>
        </defs>
    </svg>

    <div class="app-container">
        <!-- Ambient Background -->
        <div class="ambient-bg">
            <div class="orb orb-1"></div>
            <div class="orb orb-2"></div>
            <div class="orb orb-3"></div>
        </div>
        <div class="grid-pattern"></div>

        <!-- Navigation -->
        <nav class="nav">
            <a href="#" class="nav-brand" id="logoHomeBtn" title="Back to Home">
                <div class="brand-icon">
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M12 2a10 10 0 1 0 10 10A10 10 0 0 0 12 2z"/>
                        <path d="M12 6v6l4 2"/>
                    </svg>
                </div>
                <span class="brand-name">CogniTrack</span>
            </a>
            <div class="nav-links">
                <a href="#about" class="nav-link">About</a>
                <a href="#science" class="nav-link">Science</a>
                <a href="#code" class="nav-link">Backend</a>
            </div>
        </nav>

        <!-- Main Content -->
        <main class="main-content">
            
            <!-- Screen 1: Welcome -->
            <section class="screen active" id="welcomeScreen">
                <div class="welcome-content">
                    <div class="welcome-badge">AI-Powered Cognitive Assessment</div>
                    <h1 class="welcome-title">
                        Understand Your<br>
                        <span class="gradient-text">Executive Function</span>
                    </h1>
                    <p class="welcome-description">
                        A neuroscience-based tool that measures working memory, attention control, 
                        and cognitive fatigue. Get personalized, evidence-based recommendations 
                        to optimize your mental performance.
                    </p>
                    
                    <div class="welcome-features">
                        <div class="feature-card">
                            <div class="feature-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <rect x="3" y="3" width="18" height="18" rx="2"/>
                                    <circle cx="8.5" cy="8.5" r="1.5"/>
                                    <circle cx="15.5" cy="8.5" r="1.5"/>
                                    <circle cx="8.5" cy="15.5" r="1.5"/>
                                    <circle cx="15.5" cy="15.5" r="1.5"/>
                                </svg>
                            </div>
                            <h3>Working Memory</h3>
                            <p>Test your ability to hold and manipulate visual-spatial information in mind</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <circle cx="12" cy="12" r="10"/>
                                    <path d="M12 6v6l4 2"/>
                                </svg>
                            </div>
                            <h3>Inhibition Control</h3>
                            <p>Measure your ability to suppress automatic responses and control impulses</p>
                        </div>
                        <div class="feature-card">
                            <div class="feature-icon">
                                <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                    <path d="M22 12h-4l-3 9L9 3l-3 9H2"/>
                                </svg>
                            </div>
                            <h3>Fatigue Detection</h3>
                            <p>AI analyzes your performance patterns to detect cognitive fatigue</p>
                        </div>
                    </div>

                    <button class="btn btn-primary btn-large" id="startAssessmentBtn">
                        <span>Begin Assessment</span>
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M5 12h14M12 5l7 7-7 7"/>
                        </svg>
                    </button>
                    
                    <p class="welcome-note">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <circle cx="12" cy="12" r="10"/>
                            <path d="M12 16v-4M12 8h.01"/>
                        </svg>
                        Takes approximately 8-10 minutes. Find a quiet space for best results.
                    </p>
                </div>
            </section>

            <!-- Screen 2: Self-Report -->
            <section class="screen" id="selfReportScreen">
                <div class="screen-header">
                    <div class="progress-indicator">
                        <div class="progress-step active">1</div>
                        <div class="progress-line"></div>
                        <div class="progress-step">2</div>
                        <div class="progress-line"></div>
                        <div class="progress-step">3</div>
                        <div class="progress-line"></div>
                        <div class="progress-step">4</div>
                    </div>
                    <h2 class="screen-title">How Are You Feeling?</h2>
                    <p class="screen-subtitle">Help us understand your current cognitive state</p>
                </div>

                <div class="self-report-form">
                    <div class="slider-group">
                        <label class="slider-label">
                            <span class="label-text">Current Fatigue Level</span>
                            <span class="label-value" id="fatigueValue">5</span>
                        </label>
                        <div class="slider-container">
                            <span class="slider-min">Energized</span>
                            <input type="range" min="0" max="10" value="5" class="slider" id="fatigueSlider">
                            <span class="slider-max">Exhausted</span>
                        </div>
                    </div>

                    <div class="slider-group">
                        <label class="slider-label">
                            <span class="label-text">Stress Level</span>
                            <span class="label-value" id="stressValue">5</span>
                        </label>
                        <div class="slider-container">
                            <span class="slider-min">Calm</span>
                            <input type="range" min="0" max="10" value="5" class="slider" id="stressSlider">
                            <span class="slider-max">Very Stressed</span>
                        </div>
                    </div>

                    <div class="slider-group">
                        <label class="slider-label">
                            <span class="label-text">Last Night's Sleep Quality</span>
                            <span class="label-value" id="sleepValue">5</span>
                        </label>
                        <div class="slider-container">
                            <span class="slider-min">Poor</span>
                            <input type="range" min="0" max="10" value="5" class="slider" id="sleepSlider">
                            <span class="slider-max">Excellent</span>
                        </div>
                    </div>

                    <div class="slider-group">
                        <label class="slider-label">
                            <span class="label-text">Hours of Sleep</span>
                            <span class="label-value" id="sleepHoursValue">7</span>
                        </label>
                        <div class="slider-container">
                            <span class="slider-min">4 hours</span>
                            <input type="range" min="4" max="12" value="7" class="slider" id="sleepHoursSlider">
                            <span class="slider-max">12 hours</span>
                        </div>
                    </div>

                    <div class="checkbox-group">
                        <label class="checkbox-label">
                            <input type="checkbox" id="caffeineCheck">
                            <span class="checkmark"></span>
                            <span>Had caffeine today</span>
                        </label>
                        <label class="checkbox-label">
                            <input type="checkbox" id="exerciseCheck">
                            <span class="checkmark"></span>
                            <span>Exercised today</span>
                        </label>
                    </div>

                    <div class="mood-selector">
                        <label class="mood-label">Current Mood</label>
                        <div class="mood-options">
                            <button class="mood-btn" data-mood="stressed">üò∞ Stressed</button>
                            <button class="mood-btn" data-mood="tired">üò¥ Tired</button>
                            <button class="mood-btn selected" data-mood="neutral">üòê Neutral</button>
                            <button class="mood-btn" data-mood="good">üôÇ Good</button>
                            <button class="mood-btn" data-mood="great">üòä Great</button>
                        </div>
                    </div>
                </div>

                <button class="btn btn-primary" id="continueSelfReportBtn">
                    Continue to Tasks
                    <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                        <path d="M5 12h14M12 5l7 7-7 7"/>
                    </svg>
                </button>
            </section>

            <!-- Screen 3: Working Memory Task -->
            <section class="screen" id="workingMemoryScreen">
                <div class="screen-header">
                    <div class="progress-indicator">
                        <div class="progress-step completed">‚úì</div>
                        <div class="progress-line filled"></div>
                        <div class="progress-step active">2</div>
                        <div class="progress-line"></div>
                        <div class="progress-step">3</div>
                        <div class="progress-line"></div>
                        <div class="progress-step">4</div>
                    </div>
                </div>

                <div class="task-instructions" id="wmInstructions">
                    <div class="task-icon">
                        <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5">
                            <rect x="3" y="3" width="18" height="18" rx="2"/>
                            <rect x="7" y="7" width="3" height="3" fill="currentColor" opacity="0.5"/>
                            <rect x="14" y="7" width="3" height="3"/>
                            <rect x="7" y="14" width="3" height="3"/>
                            <rect x="14" y="14" width="3" height="3" fill="currentColor" opacity="0.5"/>
                        </svg>
                    </div>
                    <h2>Working Memory Task</h2>
                    <p class="task-description">
                        Watch the squares light up in sequence, then repeat the pattern by clicking 
                        the squares in the same order. The sequences will get progressively longer.
                    </p>
                    <div class="task-tips">
                        <div class="tip">
                            <span class="tip-icon">üëÄ</span>
                            <span>Watch carefully</span>
                        </div>
                        <div class="tip">
                            <span class="tip-icon">üß†</span>
                            <span>Remember the order</span>
                        </div>
                        <div class="tip">
                            <span class="tip-icon">üëÜ</span>
                            <span>Click to repeat</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="startWMTaskBtn">Start Task</button>
                </div>

                <div class="task-area hidden" id="wmTaskArea">
                    <div class="task-status">
                        <div class="status-item">
                            <span class="status-label">Round</span>
                            <span class="status-value" id="wmRound">1/10</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Length</span>
                            <span class="status-value" id="wmLength">3</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Score</span>
                            <span class="status-value" id="wmScore">0</span>
                        </div>
                    </div>
                    
                    <div class="wm-message" id="wmMessage">Watch the sequence...</div>
                    
                    <div class="wm-grid" id="wmGrid">
                        <div class="wm-cell" data-index="0"></div>
                        <div class="wm-cell" data-index="1"></div>
                        <div class="wm-cell" data-index="2"></div>
                        <div class="wm-cell" data-index="3"></div>
                        <div class="wm-cell" data-index="4"></div>
                        <div class="wm-cell" data-index="5"></div>
                        <div class="wm-cell" data-index="6"></div>
                        <div class="wm-cell" data-index="7"></div>
                        <div class="wm-cell" data-index="8"></div>
                    </div>
                </div>
            </section>

            <!-- Screen 4: Inhibition Task -->
            <section class="screen" id="inhibitionScreen">
                <div class="screen-header">
                    <div class="progress-indicator">
                        <div class="progress-step completed">‚úì</div>
                        <div class="progress-line filled"></div>
                        <div class="progress-step completed">‚úì</div>
                        <div class="progress-line filled"></div>
                        <div class="progress-step active">3</div>
                        <div class="progress-line"></div>
                        <div class="progress-step">4</div>
                    </div>
                </div>

                <div class="task-instructions" id="inhibitionInstructions">
                    <div class="task-icon go-nogo-icon">
                        <div class="go-symbol">GO</div>
                        <div class="nogo-symbol">‚úï</div>
                    </div>
                    <h2>Go / No-Go Task</h2>
                    <p class="task-description">
                        Press <kbd>SPACE</kbd> when you see a <span class="go-text">GREEN circle</span>, 
                        but <strong>do NOT press</strong> when you see a <span class="nogo-text">RED circle</span>. 
                        React as quickly and accurately as possible.
                    </p>
                    <div class="task-tips">
                        <div class="tip">
                            <span class="tip-icon">üü¢</span>
                            <span>Press SPACE</span>
                        </div>
                        <div class="tip">
                            <span class="tip-icon">üî¥</span>
                            <span>Do nothing</span>
                        </div>
                    </div>
                    <button class="btn btn-primary" id="startInhibitionTaskBtn">Start Task</button>
                </div>

                <div class="task-area hidden" id="inhibitionTaskArea">
                    <div class="task-status">
                        <div class="status-item">
                            <span class="status-label">Trial</span>
                            <span class="status-value" id="inhibitionTrial">1/40</span>
                        </div>
                        <div class="status-item">
                            <span class="status-label">Correct</span>
                            <span class="status-value" id="inhibitionCorrect">0</span>
                        </div>
                    </div>
                    
                    <div class="inhibition-display">
                        <div class="stimulus-circle" id="stimulusCircle"></div>
                        <div class="inhibition-feedback" id="inhibitionFeedback"></div>
                    </div>
                    
                    <div class="inhibition-prompt">
                        Press <kbd>SPACE</kbd> for green ‚Ä¢ Wait for red
                    </div>
                </div>
            </section>

            <!-- Screen 5: Results -->
            <section class="screen" id="resultsScreen">
                <div class="screen-header">
                    <div class="progress-indicator">
                        <div class="progress-step completed">‚úì</div>
                        <div class="progress-line filled"></div>
                        <div class="progress-step completed">‚úì</div>
                        <div class="progress-line filled"></div>
                        <div class="progress-step completed">‚úì</div>
                        <div class="progress-line filled"></div>
                        <div class="progress-step completed">‚úì</div>
                    </div>
                    <h2 class="results-title">Your Cognitive Profile</h2>
                </div>

                <div class="results-container">
                    <div class="results-summary">
                        <div class="strain-indicator">
                            <div class="strain-ring">
                                <svg viewBox="0 0 140 140">
                                    <circle class="strain-bg" cx="70" cy="70" r="60"/>
                                    <circle class="strain-fill" cx="70" cy="70" r="60" id="strainRing"/>
                                </svg>
                                <div class="strain-content">
                                    <span class="strain-value" id="strainValue">--</span>
                                    <span class="strain-label">Cognitive Load</span>
                                </div>
                            </div>
                        </div>
                        <div class="strain-level" id="strainLevel">Analyzing...</div>
                        <p class="strain-interpretation" id="strainInterpretation"></p>
                    </div>

                    <div class="score-cards">
                        <div class="score-card">
                            <div class="score-header">
                                <span class="score-icon">üß†</span>
                                <span class="score-title">Working Memory</span>
                            </div>
                            <div class="score-value" id="wmScoreResult">--</div>
                            <div class="score-bar">
                                <div class="score-fill" id="wmScoreFill"></div>
                            </div>
                            <p class="score-interpretation" id="wmInterpretation"></p>
                        </div>

                        <div class="score-card">
                            <div class="score-header">
                                <span class="score-icon">üéØ</span>
                                <span class="score-title">Inhibition Control</span>
                            </div>
                            <div class="score-value" id="inhibitionScoreResult">--</div>
                            <div class="score-bar">
                                <div class="score-fill" id="inhibitionScoreFill"></div>
                            </div>
                            <p class="score-interpretation" id="inhibitionInterpretation"></p>
                        </div>

                        <div class="score-card">
                            <div class="score-header">
                                <span class="score-icon">‚ö°</span>
                                <span class="score-title">Fatigue Level</span>
                            </div>
                            <div class="score-value" id="fatigueScoreResult">--</div>
                            <div class="score-bar fatigue-bar">
                                <div class="score-fill" id="fatigueScoreFill"></div>
                            </div>
                            <p class="score-interpretation" id="fatigueInterpretation"></p>
                        </div>
                    </div>

                    <div class="recommendations-section">
                        <h3 class="recommendations-title">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M12 2L2 7l10 5 10-5-10-5z"/>
                                <path d="M2 17l10 5 10-5M2 12l10 5 10-5"/>
                            </svg>
                            AI-Powered Recommendations
                        </h3>
                        <div class="recommendations-list" id="recommendationsList"></div>
                    </div>

                    <details class="detailed-metrics">
                        <summary>üìä View Detailed Metrics</summary>
                        <div class="metrics-grid" id="detailedMetrics"></div>
                    </details>

                    <div class="results-actions">
                        <button class="btn btn-secondary" id="downloadReportBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M21 15v4a2 2 0 01-2 2H5a2 2 0 01-2-2v-4M7 10l5 5 5-5M12 15V3"/>
                            </svg>
                            Download Report
                        </button>
                        <button class="btn btn-primary" id="retakeAssessmentBtn">
                            <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                                <path d="M1 4v6h6M23 20v-6h-6"/>
                                <path d="M20.49 9A9 9 0 005.64 5.64L1 10m22 4l-4.64 4.36A9 9 0 013.51 15"/>
                            </svg>
                            Take Again
                        </button>
                    </div>

                    <!-- Python Backend Code Section -->
                    <div class="python-section" id="pythonCodeSection">
                        <h3>Python Backend (Flask + AI Engine)</h3>
                        <p>The backend uses Flask with a custom AI engine for cognitive assessment analysis. Click to expand and copy the code.</p>
                        <div class="code-container">
                            <div class="code-header">
                                <span class="code-filename">app.py</span>
                                <button class="copy-btn" onclick="copyPythonCode()">Copy Code</button>
                            </div>
                            <div class="code-block">
                                <pre id="pythonCode">"""
CogniTrack - Executive Function Assessment & Support Tool
Flask Backend with AI Cognitive Assessment Engine
"""

from flask import Flask, render_template, request, jsonify
from flask_cors import CORS
import numpy as np
from datetime import datetime
import uuid

app = Flask(__name__)
app.secret_key = 'cognitrack-secret-key'
CORS(app)

# Session storage (use database in production)
sessions_db = {}

class CognitiveAssessmentEngine:
    """AI Engine for cognitive assessment based on neuroscience principles."""
    
    def __init__(self):
        self.norms = {
            'working_memory': {'mean_accuracy': 0.75, 'std_accuracy': 0.12, 
                               'mean_rt': 1200, 'std_rt': 300},
            'inhibition': {'mean_accuracy': 0.82, 'std_accuracy': 0.10,
                          'mean_rt': 450, 'std_rt': 100}
        }
    
    def analyze_working_memory(self, results):
        accuracy = results.get('accuracy', 0)
        response_times = results.get('response_times', [])
        
        # Z-score calculation
        accuracy_z = (accuracy - self.norms['working_memory']['mean_accuracy']) / \
                     self.norms['working_memory']['std_accuracy']
        
        mean_rt = np.mean(response_times) if response_times else 1500
        rt_z = -(mean_rt - self.norms['working_memory']['mean_rt']) / \
               self.norms['working_memory']['std_rt']
        
        # Working memory score (0-100)
        raw_score = (accuracy_z + rt_z) / 2
        wm_score = max(0, min(100, 50 + raw_score * 15))
        
        return {
            'score': round(wm_score, 1),
            'accuracy': round(accuracy * 100, 1),
            'mean_response_time': round(mean_rt, 0),
            'interpretation': self._interpret_wm(wm_score)
        }
    
    def analyze_inhibition(self, results):
        go_accuracy = results.get('go_accuracy', 0)
        nogo_accuracy = results.get('nogo_accuracy', 0)
        response_times = results.get('response_times', [])
        
        mean_rt = np.mean(response_times) if response_times else 500
        accuracy_component = (go_accuracy + nogo_accuracy * 1.5) / 2.5
        inhibition_score = max(0, min(100, accuracy_component * 100))
        
        return {
            'score': round(inhibition_score, 1),
            'go_accuracy': round(go_accuracy * 100, 1),
            'nogo_accuracy': round(nogo_accuracy * 100, 1),
            'interpretation': self._interpret_inhibition(inhibition_score)
        }
    
    def analyze_fatigue(self, task_sequence):
        if not task_sequence or len(task_sequence) < 2:
            return {'fatigue_level': 0.2, 'pattern': 'limited_data'}
        
        response_times = []
        for task in task_sequence:
            if task.get('response_times'):
                response_times.extend(task['response_times'])
        
        if len(response_times) < 4:
            return {'fatigue_level': 0.2, 'pattern': 'limited_data'}
        
        # Compare first and last quartiles
        q_size = len(response_times) // 4
        q1_rt = np.mean(response_times[:q_size])
        q4_rt = np.mean(response_times[-q_size:])
        
        rt_increase = (q4_rt - q1_rt) / q1_rt if q1_rt > 0 else 0
        fatigue_level = max(0, min(1, rt_increase + 0.3))
        
        pattern = 'general_fatigue' if rt_increase > 0.2 else 'stable'
        
        return {
            'fatigue_level': round(fatigue_level, 2),
            'rt_increase_percent': round(rt_increase * 100, 1),
            'pattern': pattern
        }
    
    def calculate_cognitive_load(self, wm, inhibition, fatigue, self_report):
        wm_load = 1 - (wm['score'] / 100)
        inh_load = 1 - (inhibition['score'] / 100)
        fat_load = fatigue['fatigue_level']
        
        subjective = (self_report.get('fatigue', 5)/10 * 0.5 + 
                     self_report.get('stress', 5)/10 * 0.3 +
                     (1 - self_report.get('sleep_quality', 5)/10) * 0.2)
        
        objective = wm_load * 0.4 + inh_load * 0.3 + fat_load * 0.3
        total = objective * 0.6 + subjective * 0.4
        
        strain = 'low' if total < 0.3 else 'moderate' if total < 0.5 \
                 else 'elevated' if total < 0.7 else 'high'
        
        return {'total_load': round(total, 2), 'strain_level': strain}
    
    def generate_recommendations(self, load, wm, inhibition, fatigue):
        recs = []
        
        if fatigue['fatigue_level'] > 0.5:
            recs.append({
                'priority': 'high', 'title': 'Take a Recovery Break',
                'description': 'Performance shows cognitive fatigue. A 10-15 min break helps.',
                'duration': '10-15 minutes', 'icon': 'break'
            })
        
        if wm['score'] < 60:
            recs.append({
                'priority': 'medium', 'title': 'Externalize Information',
                'description': 'Write down key info and use checklists to reduce WM load.',
                'duration': 'Ongoing', 'icon': 'memory'
            })
        
        if inhibition['score'] < 60:
            recs.append({
                'priority': 'medium', 'title': 'Reduce Distractions',
                'description': 'Minimize notifications and create a focused workspace.',
                'duration': 'Session-based', 'icon': 'focus'
            })
        
        return recs
    
    def _interpret_wm(self, score):
        if score >= 70: return "Working memory is performing well."
        elif score >= 50: return "Working memory is in typical range."
        else: return "Working memory shows signs of strain."
    
    def _interpret_inhibition(self, score):
        if score >= 75: return "Inhibitory control is excellent."
        elif score >= 55: return "Inhibitory control is in typical range."
        else: return "Inhibitory control shows some difficulty."

engine = CognitiveAssessmentEngine()

@app.route('/')
def index():
    return render_template('index.html')

@app.route('/api/session/start', methods=['POST'])
def start_session():
    session_id = str(uuid.uuid4())
    sessions_db[session_id] = {
        'id': session_id, 'tasks': [], 'self_report': {}
    }
    return jsonify({'success': True, 'session_id': session_id})

@app.route('/api/task/submit', methods=['POST'])
def submit_task():
    data = request.json
    session_id = data.get('session_id')
    if session_id not in sessions_db:
        return jsonify({'error': 'Invalid session'}), 400
    
    sessions_db[session_id]['tasks'].append(data)
    return jsonify({'success': True})

@app.route('/api/self-report/submit', methods=['POST'])
def submit_self_report():
    data = request.json
    session_id = data.get('session_id')
    if session_id not in sessions_db:
        return jsonify({'error': 'Invalid session'}), 400
    
    sessions_db[session_id]['self_report'] = data
    return jsonify({'success': True})

@app.route('/api/assessment/complete', methods=['POST'])
def complete_assessment():
    data = request.json
    session_id = data.get('session_id')
    if session_id not in sessions_db:
        return jsonify({'error': 'Invalid session'}), 400
    
    session = sessions_db[session_id]
    tasks = session['tasks']
    self_report = session['self_report']
    
    wm_task = next((t for t in tasks if t.get('task_type') == 'working_memory'), {})
    inh_task = next((t for t in tasks if t.get('task_type') == 'inhibition'), {})
    
    wm_analysis = engine.analyze_working_memory(wm_task)
    inh_analysis = engine.analyze_inhibition(inh_task)
    fatigue = engine.analyze_fatigue(tasks)
    load = engine.calculate_cognitive_load(wm_analysis, inh_analysis, fatigue, self_report)
    recs = engine.generate_recommendations(load, wm_analysis, inh_analysis, fatigue)
    
    return jsonify({
        'success': True,
        'profile': {
            'summary': {
                'working_memory_score': wm_analysis['score'],
                'inhibition_score': inh_analysis['score'],
                'fatigue_level': fatigue['fatigue_level'],
                'cognitive_load': load['total_load'],
                'strain_level': load['strain_level']
            },
            'detailed_analysis': {
                'working_memory': wm_analysis,
                'inhibition': inh_analysis,
                'fatigue': fatigue
            },
            'recommendations': recs
        }
    })

if __name__ == '__main__':
    app.run(debug=True, port=5000)</pre>
                            </div>
                        </div>
                    </div>
                </div>
            </section>
        </main>

        <!-- About Modal -->
        <div class="modal" id="aboutModal">
            <div class="modal-content">
                <button class="modal-close" id="closeAboutModal">&times;</button>
                <h2>About CogniTrack</h2>
                <p>
                    CogniTrack is a neuroscience-informed tool designed to help students understand 
                    their cognitive state and executive function capacity.
                </p>
                <h3>The Problem We're Solving</h3>
                <ul>
                    <li>Students burn out without understanding why</li>
                    <li>Executive dysfunction is often misattributed to "laziness"</li>
                    <li>There's no accessible way to measure cognitive overload</li>
                </ul>
                <h3>Who This Helps</h3>
                <ul>
                    <li>Students with ADHD seeking self-awareness tools</li>
                    <li>Anyone seeking academic accommodations documentation</li>
                    <li>Individuals interested in cognitive health tracking</li>
                </ul>
                <h3>Privacy First</h3>
                <p>
                    Your data stays on your device. No personal information is collected or stored.
                </p>
            </div>
        </div>

        <!-- Science Modal -->
        <div class="modal" id="scienceModal">
            <div class="modal-content">
                <button class="modal-close" id="closeScienceModal">&times;</button>
                <h2>The Neuroscience</h2>
                
                <h3>Prefrontal Cortex Function</h3>
                <p>
                    Executive functions are controlled by the prefrontal cortex (PFC):
                </p>
                <ul>
                    <li><strong>Dorsolateral PFC:</strong> Working memory and cognitive flexibility</li>
                    <li><strong>Ventrolateral PFC:</strong> Response inhibition and impulse control</li>
                    <li><strong>Anterior Cingulate:</strong> Error monitoring and conflict resolution</li>
                </ul>

                <h3>Working Memory Assessment</h3>
                <p>
                    Based on the Corsi block-tapping paradigm, measuring visuospatial working 
                    memory capacity.
                </p>

                <h3>Inhibition Control</h3>
                <p>
                    The Go/No-Go paradigm measures response inhibition. Commission errors 
                    (false alarms) indicate inhibitory control challenges.
                </p>

                <h3>Fatigue Detection</h3>
                <p>
                    We analyze vigilance decrement patterns - performance decay over time 
                    that indicates cognitive resource depletion.
                </p>
            </div>
        </div>
    </div>

    <script>
/**
 * CogniTrack - Executive Function Assessment Tool
 * Complete Frontend Application
 */

// Application State
const AppState = {
    sessionId: `demo-${Date.now()}`,
    currentScreen: 'welcome',
    selfReport: {
        fatigue: 5, stress: 5, sleepQuality: 5, sleepHours: 7,
        caffeine: false, exercise: false, mood: 'neutral'
    },
    workingMemory: {
        round: 0, maxRounds: 10, sequenceLength: 3, score: 0,
        responses: [], errors: [], responseTimes: [], startTime: null
    },
    inhibition: {
        trial: 0, totalTrials: 40, goTrials: 0, nogoTrials: 0,
        correct: 0, goCorrect: 0, nogoCorrect: 0,
        falseAlarms: 0, misses: 0, responseTimes: [], errors: [],
        startTime: null, trialStartTime: null, awaitingResponse: false, currentStimulus: null
    },
    results: null
};

// Utility functions
const $ = sel => document.querySelector(sel);
const $$ = sel => document.querySelectorAll(sel);
const randomInt = (min, max) => Math.floor(Math.random() * (max - min + 1)) + min;
const sleep = ms => new Promise(r => setTimeout(r, ms));

function shuffle(array) {
    const arr = [...array];
    for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
    }
    return arr;
}

// Screen Navigation
function showScreen(screenId) {
    $$('.screen').forEach(s => s.classList.remove('active'));
    $(`#${screenId}`).classList.add('active');
    AppState.currentScreen = screenId;
    window.scrollTo(0, 0);
}

// Self-Report Handlers
function initSelfReport() {
    const sliders = [
        { id: 'fatigueSlider', valueId: 'fatigueValue', key: 'fatigue' },
        { id: 'stressSlider', valueId: 'stressValue', key: 'stress' },
        { id: 'sleepSlider', valueId: 'sleepValue', key: 'sleepQuality' },
        { id: 'sleepHoursSlider', valueId: 'sleepHoursValue', key: 'sleepHours' }
    ];
    
    sliders.forEach(({ id, valueId, key }) => {
        const slider = $(`#${id}`);
        const valueDisplay = $(`#${valueId}`);
        slider.addEventListener('input', e => {
            valueDisplay.textContent = e.target.value;
            AppState.selfReport[key] = parseInt(e.target.value);
        });
    });
    
    $('#caffeineCheck').addEventListener('change', e => AppState.selfReport.caffeine = e.target.checked);
    $('#exerciseCheck').addEventListener('change', e => AppState.selfReport.exercise = e.target.checked);
    
    $$('.mood-btn').forEach(btn => {
        btn.addEventListener('click', () => {
            $$('.mood-btn').forEach(b => b.classList.remove('selected'));
            btn.classList.add('selected');
            AppState.selfReport.mood = btn.dataset.mood;
        });
    });
}

// Working Memory Task
class WorkingMemoryTask {
    constructor() {
        this.grid = $('#wmGrid');
        this.cells = $$('.wm-cell');
        this.message = $('#wmMessage');
        this.roundDisplay = $('#wmRound');
        this.lengthDisplay = $('#wmLength');
        this.scoreDisplay = $('#wmScore');
        this.currentSequence = [];
        this.userSequence = [];
        this.isShowingSequence = false;
        this.bindEvents();
    }
    
    bindEvents() {
        this.cells.forEach(cell => {
            cell.addEventListener('click', () => this.handleCellClick(cell));
        });
    }
    
    async start() {
        AppState.workingMemory = {
            round: 0, maxRounds: 10, sequenceLength: 3, score: 0,
            responses: [], errors: [], responseTimes: [], startTime: Date.now()
        };
        await this.nextRound();
    }
    
    async nextRound() {
        const wm = AppState.workingMemory;
        wm.round++;
        
        if (wm.round > wm.maxRounds) {
            await this.finishTask();
            return;
        }
        
        this.roundDisplay.textContent = `${wm.round}/${wm.maxRounds}`;
        this.lengthDisplay.textContent = wm.sequenceLength;
        this.scoreDisplay.textContent = wm.score;
        
        this.currentSequence = this.generateSequence(wm.sequenceLength);
        this.userSequence = [];
        
        this.message.textContent = 'Watch the sequence...';
        this.isShowingSequence = true;
        this.cells.forEach(c => c.classList.add('showing'));
        
        await sleep(1000);
        await this.showSequence();
        
        this.isShowingSequence = false;
        this.cells.forEach(c => c.classList.remove('showing'));
        this.message.textContent = 'Now repeat the sequence!';
        AppState.workingMemory.startTime = Date.now();
    }
    
    generateSequence(length) {
        const indices = [];
        while (indices.length < length) {
            const idx = randomInt(0, 8);
            if (!indices.includes(idx)) indices.push(idx);
        }
        return indices;
    }
    
    async showSequence() {
        for (const index of this.currentSequence) {
            const cell = this.cells[index];
            cell.classList.add('active');
            await sleep(600);
            cell.classList.remove('active');
            await sleep(300);
        }
    }
    
    async handleCellClick(cell) {
        if (this.isShowingSequence) return;
        
        const index = parseInt(cell.dataset.index);
        this.userSequence.push(index);
        
        const position = this.userSequence.length - 1;
        const isCorrect = this.currentSequence[position] === index;
        const rt = Date.now() - AppState.workingMemory.startTime;
        AppState.workingMemory.responseTimes.push(rt);
        
        cell.classList.add(isCorrect ? 'correct' : 'incorrect');
        await sleep(200);
        cell.classList.remove('correct', 'incorrect');
        
        if (!isCorrect) {
            AppState.workingMemory.errors.push({ type: 'commission', round: AppState.workingMemory.round });
            this.message.textContent = 'Incorrect! Next round...';
            await sleep(1000);
            await this.nextRound();
            return;
        }
        
        if (this.userSequence.length === this.currentSequence.length) {
            AppState.workingMemory.score++;
            this.scoreDisplay.textContent = AppState.workingMemory.score;
            if (AppState.workingMemory.score % 2 === 0 && AppState.workingMemory.sequenceLength < 9) {
                AppState.workingMemory.sequenceLength++;
            }
            this.message.textContent = 'Correct! ‚úì';
            await sleep(800);
            await this.nextRound();
        }
    }
    
    async finishTask() {
        showScreen('inhibitionScreen');
    }
}

// Inhibition Task
class InhibitionTask {
    constructor() {
        this.stimulus = $('#stimulusCircle');
        this.feedback = $('#inhibitionFeedback');
        this.trialDisplay = $('#inhibitionTrial');
        this.correctDisplay = $('#inhibitionCorrect');
        this.trialSequence = [];
        this.boundKeyHandler = this.handleKeyPress.bind(this);
    }
    
    generateTrialSequence() {
        const goCount = Math.round(AppState.inhibition.totalTrials * 0.7);
        const nogoCount = AppState.inhibition.totalTrials - goCount;
        return shuffle([...Array(goCount).fill('go'), ...Array(nogoCount).fill('nogo')]);
    }
    
    async start() {
        AppState.inhibition = {
            trial: 0, totalTrials: 40, goTrials: 0, nogoTrials: 0,
            correct: 0, goCorrect: 0, nogoCorrect: 0,
            falseAlarms: 0, misses: 0, responseTimes: [], errors: [],
            startTime: Date.now(), trialStartTime: null, awaitingResponse: false, currentStimulus: null
        };
        
        this.trialSequence = this.generateTrialSequence();
        document.addEventListener('keydown', this.boundKeyHandler);
        await sleep(500);
        await this.nextTrial();
    }
    
    async nextTrial() {
        const inh = AppState.inhibition;
        if (inh.trial >= inh.totalTrials) {
            await this.finishTask();
            return;
        }
        
        inh.trial++;
        this.trialDisplay.textContent = `${inh.trial}/${inh.totalTrials}`;
        
        this.stimulus.className = 'stimulus-circle';
        this.hideFeedback();
        
        await sleep(randomInt(500, 1200));
        
        const stimulusType = this.trialSequence[inh.trial - 1];
        inh.currentStimulus = stimulusType;
        
        if (stimulusType === 'go') {
            inh.goTrials++;
            this.stimulus.classList.add('go');
        } else {
            inh.nogoTrials++;
            this.stimulus.classList.add('nogo');
        }
        
        inh.trialStartTime = Date.now();
        inh.awaitingResponse = true;
        
        this.trialTimeout = setTimeout(() => this.handleTimeout(), 1500);
    }
    
    handleKeyPress(e) {
        if (e.code !== 'Space' || !AppState.inhibition.awaitingResponse) return;
        e.preventDefault();
        clearTimeout(this.trialTimeout);
        
        const inh = AppState.inhibition;
        const rt = Date.now() - inh.trialStartTime;
        inh.awaitingResponse = false;
        
        if (inh.currentStimulus === 'go') {
            inh.correct++;
            inh.goCorrect++;
            inh.responseTimes.push(rt);
            this.showFeedback('Correct!', 'correct');
        } else {
            inh.falseAlarms++;
            this.showFeedback('Wait on red!', 'incorrect');
        }
        
        this.correctDisplay.textContent = inh.correct;
        setTimeout(() => this.nextTrial(), 600);
    }
    
    handleTimeout() {
        const inh = AppState.inhibition;
        inh.awaitingResponse = false;
        
        if (inh.currentStimulus === 'go') {
            inh.misses++;
            this.showFeedback('Too slow!', 'incorrect');
        } else {
            inh.correct++;
            inh.nogoCorrect++;
            this.showFeedback('Good!', 'correct');
        }
        
        this.correctDisplay.textContent = inh.correct;
        setTimeout(() => this.nextTrial(), 600);
    }
    
    showFeedback(text, type) {
        this.feedback.textContent = text;
        this.feedback.className = `inhibition-feedback show ${type}`;
    }
    
    hideFeedback() {
        this.feedback.className = 'inhibition-feedback';
    }
    
    async finishTask() {
        document.removeEventListener('keydown', this.boundKeyHandler);
        await completeAssessment();
    }
}

// Generate Results (Client-side AI)
function generateResults() {
    const wm = AppState.workingMemory;
    const inh = AppState.inhibition;
    const sr = AppState.selfReport;
    
    const wmAccuracy = wm.score / wm.maxRounds;
    const wmScore = Math.round(wmAccuracy * 100);
    
    const goAcc = inh.goTrials > 0 ? inh.goCorrect / inh.goTrials : 0;
    const nogoAcc = inh.nogoTrials > 0 ? inh.nogoCorrect / inh.nogoTrials : 0;
    const inhibitionScore = Math.round(((goAcc + nogoAcc * 1.5) / 2.5) * 100);
    
    let fatigueLevel = 0.3;
    if (wm.responseTimes.length > 4) {
        const firstHalf = wm.responseTimes.slice(0, Math.floor(wm.responseTimes.length / 2));
        const secondHalf = wm.responseTimes.slice(Math.floor(wm.responseTimes.length / 2));
        const avgFirst = firstHalf.reduce((a, b) => a + b, 0) / firstHalf.length;
        const avgSecond = secondHalf.reduce((a, b) => a + b, 0) / secondHalf.length;
        fatigueLevel = Math.min(1, Math.max(0, (avgSecond - avgFirst) / avgFirst + 0.3));
    }
    
    const objectiveLoad = (1 - wmScore/100) * 0.4 + (1 - inhibitionScore/100) * 0.3 + fatigueLevel * 0.3;
    const subjectiveLoad = (sr.fatigue/10) * 0.5 + (sr.stress/10) * 0.3 + (1 - sr.sleepQuality/10) * 0.2;
    const totalLoad = objectiveLoad * 0.6 + subjectiveLoad * 0.4;
    
    let strainLevel = 'low';
    if (totalLoad > 0.7) strainLevel = 'high';
    else if (totalLoad > 0.5) strainLevel = 'elevated';
    else if (totalLoad > 0.3) strainLevel = 'moderate';
    
    const recommendations = [];
    
    if (fatigueLevel > 0.5) {
        recommendations.push({
            priority: 'high', title: 'Take a Recovery Break',
            description: 'Your performance shows signs of cognitive fatigue. A 10-15 minute break with light movement can help restore focus.',
            duration: '10-15 minutes', icon: 'break'
        });
    }
    
    if (wmScore < 60) {
        recommendations.push({
            priority: wmScore < 40 ? 'high' : 'medium', title: 'Externalize Information',
            description: 'Your working memory is under strain. Write down key information, use checklists, and keep only essential items visible.',
            duration: 'Ongoing', icon: 'memory'
        });
    }
    
    if (inhibitionScore < 60) {
        recommendations.push({
            priority: inhibitionScore < 40 ? 'high' : 'medium', title: 'Reduce Distractions',
            description: 'Your inhibitory control is taxed. Minimize notifications, close unnecessary tabs, and create a focused workspace.',
            duration: 'Session-based', icon: 'focus'
        });
    }
    
    if (sr.fatigue > 6) {
        recommendations.push({
            priority: 'medium', title: 'Try a Brief Relaxation Exercise',
            description: 'High fatigue is affecting your cognitive performance. A 2-minute breathing exercise can help activate your parasympathetic system.',
            duration: '2-5 minutes', icon: 'breathe'
        });
    }
    
    if (sr.sleepQuality < 5) {
        recommendations.push({
            priority: 'medium', title: 'Prioritize Sleep Quality',
            description: 'Poor sleep is impacting your cognitive function. Consider adjusting your sleep schedule or environment.',
            duration: 'Tonight', icon: 'sleep'
        });
    }
    
    if (recommendations.length === 0) {
        recommendations.push({
            priority: 'low', title: 'Maintain Current Practices',
            description: 'Your cognitive function is performing well. Continue with your current habits and regular breaks.',
            duration: 'Ongoing', icon: 'maintain'
        });
    }
    
    const interpretations = {
        low: "Your executive functions are performing well. You're in a good state for complex cognitive tasks.",
        moderate: "Your cognitive state is manageable but showing some strain. Consider the recommendations to maintain performance.",
        elevated: "Your executive functions are showing significant strain. Taking breaks and using support strategies is recommended.",
        high: "Your cognitive resources are heavily taxed. Priority should be given to recovery and task simplification."
    };
    
    return {
        summary: {
            working_memory_score: wmScore,
            inhibition_score: inhibitionScore,
            fatigue_level: fatigueLevel,
            cognitive_load: totalLoad,
            strain_level: strainLevel
        },
        detailed_analysis: {
            working_memory: {
                score: wmScore,
                accuracy: Math.round(wmAccuracy * 100),
                mean_response_time: wm.responseTimes.length > 0 
                    ? Math.round(wm.responseTimes.reduce((a,b) => a+b, 0) / wm.responseTimes.length) : 0,
                interpretation: wmScore >= 70 ? "Working memory is performing well." 
                    : wmScore >= 50 ? "Working memory is in typical range." : "Working memory shows signs of strain."
            },
            inhibition: {
                score: inhibitionScore,
                go_accuracy: Math.round(goAcc * 100),
                nogo_accuracy: Math.round(nogoAcc * 100),
                commission_error_rate: inh.nogoTrials > 0 ? Math.round((inh.falseAlarms / inh.nogoTrials) * 100) : 0,
                interpretation: inhibitionScore >= 75 ? "Inhibitory control is excellent."
                    : inhibitionScore >= 55 ? "Inhibitory control is in typical range." : "Inhibitory control shows some difficulty."
            },
            fatigue: {
                fatigue_level: fatigueLevel,
                pattern: fatigueLevel > 0.5 ? 'general_fatigue' : 'stable',
                interpretation: fatigueLevel > 0.5 ? "Performance shows signs of cognitive fatigue." : "Performance remained relatively stable."
            }
        },
        recommendations,
        interpretation: interpretations[strainLevel]
    };
}

async function completeAssessment() {
    showScreen('resultsScreen');
    
    $('#strainValue').textContent = '--';
    $('#strainLevel').textContent = 'Analyzing...';
    
    await sleep(500);
    
    const results = generateResults();
    AppState.results = results;
    displayResults(results);
}

function displayResults(profile) {
    const summary = profile.summary;
    const detailed = profile.detailed_analysis;
    
    const loadPercent = Math.round(summary.cognitive_load * 100);
    const circumference = 377;
    const offset = circumference - (loadPercent / 100) * circumference;
    
    setTimeout(() => {
        $('#strainValue').textContent = loadPercent + '%';
        const ring = document.getElementById('strainRing');
        if (ring) ring.style.strokeDashoffset = offset;
    }, 300);
    
    const strainLevel = $('#strainLevel');
    strainLevel.textContent = summary.strain_level.charAt(0).toUpperCase() + summary.strain_level.slice(1) + ' Cognitive Load';
    strainLevel.className = `strain-level ${summary.strain_level}`;
    
    $('#strainInterpretation').textContent = profile.interpretation;
    
    setTimeout(() => {
        $('#wmScoreResult').textContent = summary.working_memory_score;
        $('#wmScoreFill').style.width = summary.working_memory_score + '%';
        $('#wmInterpretation').textContent = detailed.working_memory.interpretation;
        
        $('#inhibitionScoreResult').textContent = summary.inhibition_score;
        $('#inhibitionScoreFill').style.width = summary.inhibition_score + '%';
        $('#inhibitionInterpretation').textContent = detailed.inhibition.interpretation;
        
        const fatiguePercent = Math.round(summary.fatigue_level * 100);
        $('#fatigueScoreResult').textContent = fatiguePercent + '%';
        $('#fatigueScoreFill').style.width = fatiguePercent + '%';
        $('#fatigueInterpretation').textContent = detailed.fatigue.interpretation;
    }, 500);
    
    const recList = $('#recommendationsList');
    recList.innerHTML = '';
    
    const iconMap = {
        'break': '‚òï', 'memory': 'üìù', 'chunk': 'üß©', 'focus': 'üéØ',
        'attention': 'üëÅÔ∏è', 'sleep': 'üò¥', 'breathe': 'üßò', 'schedule': 'üìÖ', 'maintain': '‚ú®'
    };
    
    profile.recommendations.forEach(rec => {
        const card = document.createElement('div');
        card.className = `recommendation-card priority-${rec.priority}`;
        card.innerHTML = `
            <div class="rec-icon">${iconMap[rec.icon] || 'üí°'}</div>
            <div class="rec-content">
                <div class="rec-header">
                    <span class="rec-title">${rec.title}</span>
                    <span class="rec-priority ${rec.priority}">${rec.priority}</span>
                </div>
                <p class="rec-description">${rec.description}</p>
                <div class="rec-meta">
                    <span class="rec-duration">${rec.duration}</span>
                </div>
            </div>
        `;
        recList.appendChild(card);
    });
    
    const metricsGrid = $('#detailedMetrics');
    metricsGrid.innerHTML = `
        <div class="metric-item">
            <div class="metric-value">${detailed.working_memory.accuracy}%</div>
            <div class="metric-label">WM Accuracy</div>
        </div>
        <div class="metric-item">
            <div class="metric-value">${detailed.working_memory.mean_response_time}ms</div>
            <div class="metric-label">Avg Response</div>
        </div>
        <div class="metric-item">
            <div class="metric-value">${detailed.inhibition.go_accuracy}%</div>
            <div class="metric-label">Go Accuracy</div>
        </div>
        <div class="metric-item">
            <div class="metric-value">${detailed.inhibition.nogo_accuracy}%</div>
            <div class="metric-label">No-Go Accuracy</div>
        </div>
        <div class="metric-item">
            <div class="metric-value">${detailed.inhibition.commission_error_rate}%</div>
            <div class="metric-label">False Alarms</div>
        </div>
        <div class="metric-item">
            <div class="metric-value">${Math.round(summary.cognitive_load * 100)}%</div>
            <div class="metric-label">Total Load</div>
        </div>
    `;
}

function downloadReport() {
    if (!AppState.results) return;
    
    const r = AppState.results;
    const report = `
COGNITRACK COGNITIVE ASSESSMENT REPORT
======================================
Generated: ${new Date().toLocaleString()}

SUMMARY
-------
Working Memory Score: ${r.summary.working_memory_score}/100
Inhibition Control Score: ${r.summary.inhibition_score}/100
Fatigue Level: ${Math.round(r.summary.fatigue_level * 100)}%
Overall Cognitive Load: ${Math.round(r.summary.cognitive_load * 100)}%
Strain Level: ${r.summary.strain_level.toUpperCase()}

INTERPRETATION
--------------
${r.interpretation}

RECOMMENDATIONS
---------------
${r.recommendations.map((rec, i) => 
`${i + 1}. [${rec.priority.toUpperCase()}] ${rec.title}
   ${rec.description}
   Duration: ${rec.duration}`).join('\n\n')}

---
Note: This assessment is for informational purposes only.
Powered by CogniTrack - Neuroscience-Based Cognitive Assessment
    `.trim();
    
    const blob = new Blob([report], { type: 'text/plain' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = `cognitrack-report-${new Date().toISOString().split('T')[0]}.txt`;
    document.body.appendChild(a);
    a.click();
    document.body.removeChild(a);
    URL.revokeObjectURL(url);
}

function copyPythonCode() {
    const code = document.getElementById('pythonCode').textContent;
    navigator.clipboard.writeText(code).then(() => {
        const btn = document.querySelector('.copy-btn');
        btn.textContent = 'Copied!';
        setTimeout(() => btn.textContent = 'Copy Code', 2000);
    });
}

// Modal Handlers
function initModals() {
    $('a[href="#about"]').addEventListener('click', e => {
        e.preventDefault();
        $('#aboutModal').classList.add('active');
    });
    
    $('#closeAboutModal').addEventListener('click', () => {
        $('#aboutModal').classList.remove('active');
    });
    
    $('a[href="#science"]').addEventListener('click', e => {
        e.preventDefault();
        $('#scienceModal').classList.add('active');
    });
    
    $('#closeScienceModal').addEventListener('click', () => {
        $('#scienceModal').classList.remove('active');
    });
    
    $('a[href="#code"]').addEventListener('click', e => {
        e.preventDefault();
        showScreen('resultsScreen');
        setTimeout(() => {
            document.getElementById('pythonCodeSection').scrollIntoView({ behavior: 'smooth' });
        }, 100);
    });
    
    $$('.modal').forEach(modal => {
        modal.addEventListener('click', e => {
            if (e.target === modal) modal.classList.remove('active');
        });
    });
}

// Initialize
let wmTask = null;
let inhibitionTask = null;

document.addEventListener('DOMContentLoaded', () => {
    initSelfReport();
    initModals();
    
    wmTask = new WorkingMemoryTask();
    inhibitionTask = new InhibitionTask();
    
    $('#startAssessmentBtn').addEventListener('click', () => showScreen('selfReportScreen'));
    
    $('#logoHomeBtn').addEventListener('click', (e) => {
        e.preventDefault();
        showScreen('welcomeScreen');
    });
    
    $('#continueSelfReportBtn').addEventListener('click', () => showScreen('workingMemoryScreen'));
    
    $('#startWMTaskBtn').addEventListener('click', () => {
        $('#wmInstructions').classList.add('hidden');
        $('#wmTaskArea').classList.remove('hidden');
        wmTask.start();
    });
    
    $('#startInhibitionTaskBtn').addEventListener('click', () => {
        $('#inhibitionInstructions').classList.add('hidden');
        $('#inhibitionTaskArea').classList.remove('hidden');
        inhibitionTask.start();
    });
    
    $('#downloadReportBtn').addEventListener('click', downloadReport);
    
    $('#retakeAssessmentBtn').addEventListener('click', () => {
        AppState.results = null;
        AppState.workingMemory = {
            round: 0, maxRounds: 10, sequenceLength: 3, score: 0,
            responses: [], errors: [], responseTimes: [], startTime: null
        };
        AppState.inhibition = {
            trial: 0, totalTrials: 40, goTrials: 0, nogoTrials: 0,
            correct: 0, goCorrect: 0, nogoCorrect: 0,
            falseAlarms: 0, misses: 0, responseTimes: [], errors: [],
            startTime: null, trialStartTime: null, awaitingResponse: false, currentStimulus: null
        };
        
        $('#wmInstructions').classList.remove('hidden');
        $('#wmTaskArea').classList.add('hidden');
        $('#inhibitionInstructions').classList.remove('hidden');
        $('#inhibitionTaskArea').classList.add('hidden');
        
        showScreen('welcomeScreen');
    });
    
    console.log('CogniTrack initialized');
});
    </script>
</body>
</html>
